<!-- Include Google Maps JS API -->
<script type="text/javascript"
  src="https://maps.googleapis.com/maps/api/js?libraries=places&key=<%= ENV['GOOGLE_API_BROWSER_KEY']%>">
</script>

<script type="text/javascript" src="autocomplete.js"></script>
<div class="wrapper-grey">
  <div class="container">
    <%= render 'search' %>
  </div>
</div>
<section id="pricing" class="pricing-section">
  <div class="container">
    <% if @lessons == [] %>
    <div class="row">
      <div class="col-sm-8 col-sm-offset-2 center-title">
        <p> <%= t('.no_result') %> </p>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-6">
        <% Lesson.all.where(status: 'confirmed').where('start_date >= ?', DateTime.now).order(:start_date).each do |lesson| %>
        <div class="col-sm-6">
          <div class="price-box text-center wow  fadeInUp animated" data-wow-delay="0.1s" style="visibility: visible; animation-delay: 0.1s; animation-name: fadeInUp;">
            <%= show_card_avatar(@user) %>
            <p><%= lesson.teacher.first_name %> </p>
            <h3><%= lesson.name%></h3>
            <div class="price" id="date">
              <p><%= lesson.start_date.to_time.to_formatted_s(:short) %></p>
            </div>
            <div id="price">
              <%= lesson.price %> â‚¬
            </div>
            <%= link_to t('.more'), lesson_path(lesson), class:"btn btn-lg btn-default btn-radius" %>
          </div><!--price box end-->
        </div><!--price col end-->
        <% end %>
      </div>
      <div class="col-sm-6">
        <div id="map" style="width: 100%; height: 600px;"></div>
      </div>
    </div>
    <% else %>
    <div class="row">
      <div class="col-sm-6">
        <% @lessons.each do |lesson| %>
        <div class="col-sm-6">
          <div class="price-box text-center wow  fadeInUp animated" data-wow-delay="0.1s" style="visibility: visible; animation-delay: 0.1s; animation-name: fadeInUp;">
            <%= show_card_avatar(lesson.teacher) %>
            <p><%= lesson.teacher.first_name %> </p>
            <h3><%= lesson.name%></h3>
            <div class="price" id="date">
              <p><%= lesson.start_date.to_time.to_formatted_s(:short) %></p>
            </div>
            <div id="price">
              <%= humanized_money_with_symbol(lesson.price) %>
            </div>
            <%= link_to t('.more'), lesson_path(lesson), class:"btn btn-lg btn-default btn-radius" %>
          </div><!--price box end-->
        </div><!--price col end-->
        <% end %>
      </div>
      <div class="col-sm-6">
        <div id="map" style="width: 100%; height: 600px;"></div>
      </div>
    </div>
    <% end %>
  </div>
</section>

<% content_for(:js) do %>
  <%= javascript_tag do %>
    $(document).on('ready', function() {
      handler = Gmaps.build('Google');
      handler.buildMap({ internal: { id: 'map' } }, function(){
        markers = handler.addMarkers(<%= raw @markers.to_json %>);
        handler.bounds.extendWith(markers);
        handler.fitMapToBounds();
      });
    })
  <% end %>
<% end %>
